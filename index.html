<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rehab Center Feedback System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
   <!-- Header with Website Name -->
   <header>
    <h1 id="websiteTitle">Rehab Connect</h1>
    <!-- Language Toggle Button -->
    <div>
        <button id="toggleLanguage">Switch to Hindi</button>
    </div>
</header>

<div class="nav">
    <button id="adminPortalButton">Admin Portal</button>
    <button id="feedbackPortalButton">Feedback Portal</button>
    <button id="aboutDeveloperB">About Developer</button>
</div>

<!-- About the Developer Section -->
<div id="aboutDeveloper" class="portal">
    <h2 id="aboutTitle">About the Developer</h2>
    <div class="box">
        <p>
            Hi, I'm <strong>Zene Ansari</strong>, the creator of this Rehab Center Feedback System. 
            I developed this platform to help rehabilitation centers gather valuable feedback 
            from patients and improve their services. This project incorporates user-friendly 
            feedback submission, management, and analytics features to enhance the overall experience.
        </p>
        <p>
            If you have any questions or feedback about this project, feel free to contact me. 
            Thank you for using this system and supporting better healthcare services!
        </p>
    </div>

    <!-- FAQs Section -->
    <h3>Frequently Asked Questions (FAQs)</h3><br><br>
    <div class="faq-box">
        <div class="faq-item">
            <h4>Q1: How can I provide feedback?</h4>
            <p>A: You can provide feedback through the Feedback Portal by filling out the feedback form.</p><br>
        </div>
        <div class="faq-item">
            <h4>Q2: Is my feedback anonymous?</h4>
            <p>A: Yes, you can choose to submit your feedback anonymously by checking the respective checkbox on the feedback form.</p><br>
        </div>
        <div class="faq-item">
            <h4>Q3: What types of feedback can I submit?</h4>
            <p>A: You can submit feedback regarding services, staff, and facilities, among others.</p><br>
        </div>
        <div class="faq-item">
            <h4>Q4: Can family members submit feedback on behalf of patients?</h4>
            <p>A: Yes, family members can submit feedback on behalf of patients using the Feedback Portal.</p><br>
        </div>
    </div>
</div>

<!-- Admin Portal -->
<div id="adminPortal" class="portal">
    <h2 id="enterRehabTitle">Enter Rehab Name to View Data</h2>
    <div class="box">
        <div class="form">
            <input type="text" id="adminRehabName" placeholder="Enter Rehab Name" required>
            <button id="loadRehabDataButton" class="sub">Load Data</button>
        </div>
        <div class="form">
            <h3 id="viewFeedbackTitle">View Feedback</h3>
            <button id="viewFeedbackButton" class="sub">View Feedback</button>
            <div id="feedbackList"></div>
        </div>

        <div class="form">
            <h3 id="manageFeedbackTitle">Manage Feedback</h3>
            <select id="feedbackSelect">
                <option value="">Select Feedback to Delete</option>
            </select>
            <button id="deleteFeedbackButton" class="sub" style="background-color: red;">Delete Feedback</button>
        </div>

        <div class="form">
            <h3 id="analyticsTitle">Feedback Analytics</h3>
            <div id="feedbackAnalytics"></div>
        </div>
    </div>
</div>

<!-- Feedback Portal -->
<div id="feedbackPortal" class="portal">
    <h2 id="submitFeedbackTitle">Submit Feedback</h2>
    <div class="box">
        <div class="form">
            <form id="feedbackForm">
                <div class="inputbox">
                    <select id="feedbackType" required>
                        <option value="">Select Feedback Type</option>
                        <option value="patient">Patient</option>
                        <option value="family">Family Member</option>
                    </select>
                    <span id="feedbackTypeLabel">Feedback Type</span>
                </div>
                <div class="inputbox">
                    <input type="text" id="rehabName" placeholder="Rehab Name" required>
                    <span id="rehabNameLabel">Rehab Name</span>
                </div>
                <div class="inputbox">
                    <input type="text" id="personName" placeholder="Your Name (optional)">
                    <span id="personNameLabel">Your Name</span>
                </div>
                <div class="inputbox">
                    <textarea id="feedbackMessage" required></textarea>
                    <span id="feedbackMessageLabel">Your Feedback</span>
                </div>
                <div class="inputbox">
                    <select id="feedbackCategory" required>
                        <option value="">Select Category</option>
                        <option value="service">Service</option>
                        <option value="staff">Staff</option>
                        <option value="facilities">Facilities</option>
                    </select>
                    <span id="feedbackCategoryLabel">Category</span>
                </div>
                <div class="inputbox">
                    <label id="ratingLabel">Rating:</label>
                    <input type="number" id="feedbackRating" min="1" max="5" required>
                </div>
                <div class="minputbox">
                    <label><input type="checkbox" id="anonymousCheckbox"> <span id="anonymousLabel">Submit Anonymously</span></label>
                </div>
                <!-- MCQs Section -->
                <div class="minputbox">
                    <p id="serviceSatisfactionLabel">How satisfied are you with the service?</p>
                    <div class="mcq-option">
                        <label><input type="radio" name="serviceSatisfaction" value="Very Satisfied" required> Very Satisfied</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="serviceSatisfaction" value="Satisfied"> Satisfied</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="serviceSatisfaction" value="Neutral"> Neutral</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="serviceSatisfaction" value="Dissatisfied"> Dissatisfied</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="serviceSatisfaction" value="Very Dissatisfied"> Very Dissatisfied</label>
                    </div>
                </div>
                <div class="minputbox">
                    <p id="recommendationLabel">Would you recommend this rehab center to others?</p>
                    <div class="mcq-option">
                        <label><input type="radio" name="recommendation" value="Yes" required> Yes</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="recommendation" value="No"> No</label>
                    </div>
                </div>
                <div class="minputbox">
                    <p id="facilityQualityLabel">How would you rate the quality of the facilities?</p>
                    <div class="mcq-option">
                        <label><input type="radio" name="facilityQuality" value="Excellent" required> Excellent</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="facilityQuality" value="Good"> Good</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="facilityQuality" value="Average"> Average</label>
                    </div>
                    <div class="mcq-option">
                        <label><input type="radio" name="facilityQuality" value="Poor"> Poor</label>
                    </div>
                </div>

                <input type="submit" value="Submit Feedback" class="sub" id="submitFeedbackButton">
            </form>
        </div>
    </div>
</div>
<!-- React and Firebase Integration -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBxXF4PdygVy4hLci-62ug27UkcN0JH59I",
        authDomain: "rehab-d0034.firebaseapp.com",
        projectId: "rehab-d0034",
        storageBucket: "rehab-d0034.appspot.com",
        messagingSenderId: "889479890648",
        appId: "1:889479890648:web:38a68a3551a1f05750f9ad",
        measurementId: "G-GQ04FHMMF8"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const validToken = 'zeneSecretToken05';
 if (token !== validToken) {
        alert('Unauthorized access.');
        document.body.innerHTML = '<h1>Unauthorized Access</h1>';
        return;
    }
       
loadFeedback();
    function switchLanguage() {
                const isEnglish = document.getElementById("toggleLanguage").innerText === "Switch to Hindi";
                document.getElementById("websiteTitle").innerText = isEnglish ? "रिहैब कनेक्ट" : "Rehab Connect";
                document.getElementById("aboutTitle").innerText = isEnglish ? "डेवलपर के बारे में" : "About the Developer";
                document.getElementById("submitFeedbackTitle").innerText = isEnglish ? "फीडबैक सबमिट करें" : "Submit Feedback";
                document.getElementById("enterRehabTitle").innerText = isEnglish ? "डेटा देखने के लिए रिहैब नाम दर्ज करें" : "Enter Rehab Name to View Data";
                document.getElementById("viewFeedbackTitle").innerText = isEnglish ? "फीडबैक देखें" : "View Feedback";
                document.getElementById("manageFeedbackTitle").innerText = isEnglish ? "फीडबैक प्रबंधित करें" : "Manage Feedback";
                document.getElementById("analyticsTitle").innerText = isEnglish ? "फीडबैक एनालिटिक्स" : "Feedback Analytics";
                document.getElementById("feedbackTypeLabel").innerText = isEnglish ? "फीडबैक प्रकार" : "Feedback Type";
                document.getElementById("rehabNameLabel").innerText = isEnglish ? "रिहैब नाम" : "Rehab Name";
                document.getElementById("personNameLabel").innerText = isEnglish ? "आपका नाम" : "Your Name";
                document.getElementById("feedbackMessageLabel").innerText = isEnglish ? "आपकी फीडबैक" : "Your Feedback";
                document.getElementById("feedbackCategoryLabel").innerText = isEnglish ? "श्रेणी" : "Category";
                document.getElementById("ratingLabel").innerText = isEnglish ? "रेटिंग:" : "Rating:";
                document.getElementById("anonymousLabel").innerText = isEnglish ? "गुमनाम तरीके से सबमिट करें" : "Submit Anonymously";
                document.getElementById("serviceSatisfactionLabel").innerText = isEnglish ? "सेवा से संतोषजनकता" : "Service Satisfaction";
                document.getElementById("recommendationLabel").innerText = isEnglish ? "अन्य को सिफारिश करेंगे?" : "Would you recommend this rehab center to others?";
                document.getElementById("facilityQualityLabel").innerText = isEnglish ? "सुविधाओं की गुणवत्ता" : "Facility Quality";
                document.getElementById("toggleLanguage").innerText = isEnglish ? "Switch to English" : "Switch to Hindi";
            }

            // Event listener for language toggle button
            document.getElementById("toggleLanguage").addEventListener('click', switchLanguage);

            // Initialize language
            switchLanguage();
    
    function switchPortal(showPortalId) {
        const portals = ['adminPortal', 'feedbackPortal', 'aboutDeveloper'];
        portals.forEach(portalId => {
            const portal = document.getElementById(portalId);
            portal.style.display = (portalId === showPortalId) ? 'block' : 'none';
        });
    }

    // Event Listeners to switch between portals
    document.getElementById("adminPortalButton").addEventListener('click', () => {
        switchPortal('adminPortal');
    });

    document.getElementById("feedbackPortalButton").addEventListener('click', () => {
        switchPortal('feedbackPortal');
    });

    document.getElementById("aboutDeveloperB").addEventListener('click', () => {
        switchPortal('aboutDeveloper');
    });

    // Load rehab data and analytics
    document.getElementById("loadRehabDataButton").addEventListener('click', () => {
        loadFeedback();
        loadAnalytics();
    });

    // Submit feedback
    
    document.getElementById("feedbackForm").addEventListener('submit', async function (e) {
    e.preventDefault(); // Prevent the form from submitting the traditional way

    // Retrieve input values
    const feedbackType = document.getElementById("feedbackType").value;
    const rehabName = document.getElementById("rehabName").value.trim();
    const personName = document.getElementById("personName").value.trim();
    const feedbackMessage = document.getElementById("feedbackMessage").value.trim();
    const feedbackCategory = document.getElementById("feedbackCategory").value;
    const feedbackRating = parseInt(document.getElementById("feedbackRating").value);
    const anonymous = document.getElementById("anonymousCheckbox").checked;
    
    // Retrieve MCQ responses
    const serviceSatisfaction = document.querySelector('input[name="serviceSatisfaction"]:checked')?.value || "Not Provided";
    const recommendation = document.querySelector('input[name="recommendation"]:checked')?.value || "Not Provided";
    const facilityQuality = document.querySelector('input[name="facilityQuality"]:checked')?.value || "Not Provided";

    // Check if the required fields are filled
    if (!feedbackType || !rehabName || !feedbackMessage || !feedbackCategory || isNaN(feedbackRating)) {
        alert("Please fill in all required fields.");
        return;
    }

    // Prepare feedback data
    const feedbackData = {
        type: feedbackType, // Add feedback type
        name: anonymous ? "Anonymous" : personName || "Anonymous", // Default to "Anonymous" if no name provided
        message: feedbackMessage,
        category: feedbackCategory,
        rating: feedbackRating,
        serviceSatisfaction: serviceSatisfaction,
        recommendation: recommendation,
        facilityQuality: facilityQuality,
        timestamp: new Date().toISOString() // Store the current date and time as a string
    };

    try {
        // Save feedback data to Firestore under a collection named 'feedback_{rehabName}'
        await setDoc(doc(collection(db, `feedback_${rehabName}`)), feedbackData);
        alert("Feedback submitted successfully!");

        // Clear the form after successful submission
        document.getElementById("feedbackForm").reset();
    } catch (error) {
        console.error("Error submitting feedback: ", error);
        alert("Error submitting feedback. Please try again.");
    }
});


    });

    // Function to load all feedback for a given rehab name
    async function loadFeedback() {
        const feedbackSelect = document.getElementById("feedbackSelect");
        const feedbackList = document.getElementById("feedbackList");
        const rehabName = document.getElementById("adminRehabName").value.trim(); // Get rehab name from the input field
        feedbackSelect.innerHTML = '<option value="">Select Feedback to Delete</option>';
        feedbackList.innerHTML = '';

        if (!rehabName) {
            alert('Please enter a rehab name to load feedback');
            return;
        }

        try {
            const q = query(collection(db, `feedback_${rehabName}`));
            const querySnapshot = await getDocs(q);

            querySnapshot.forEach((doc) => {
    const feedback = doc.data();
    let listItem = document.createElement("div");
    listItem.textContent = `
        ${feedback.name ? feedback.name + ': ' : 'Anonymous: '}
        ${feedback.message} 
        (${new Date(feedback.timestamp).toLocaleString()}) 
        --- Rating: ${feedback.rating} 
        --- Category: ${feedback.category} 
        --- Type: ${feedback.type}`; // Include feedback type here
    feedbackList.appendChild(listItem);

    let option = document.createElement("option");
    option.value = doc.id;
    option.textContent = `${feedback.type === 'patient' ? 'Patient: ' : 'Family: '}${feedback.message.substring(0, 50)}...`; // Show feedback type in the dropdown
    feedbackSelect.appendChild(option);


            });
        } catch (error) {
            console.error("Error loading feedback: ", error);
        }
    }

    // Function to load analytics data
    
async function loadAnalytics() {
    const feedbackAnalytics = document.getElementById("feedbackAnalytics");
    const rehabName = document.getElementById("adminRehabName").value.trim();

    if (!rehabName) {
        alert('Please enter a rehab name to load analytics');
        return;
    }

    try {
        const q = query(collection(db, `feedback_${rehabName}`));
        const querySnapshot = await getDocs(q);

        let totalRatings = 0;
        let count = 0;
        let categoryCounts = {};
        let serviceSatisfactionCounts = {};
        let recommendationCounts = {};
        let facilityQualityCounts = {};

        querySnapshot.forEach((doc) => {
            const feedback = doc.data();
            totalRatings += feedback.rating;
            count++;
            categoryCounts[feedback.category] = (categoryCounts[feedback.category] || 0) + 1;
            serviceSatisfactionCounts[feedback.serviceSatisfaction] = (serviceSatisfactionCounts[feedback.serviceSatisfaction] || 0) + 1;
            recommendationCounts[feedback.recommendation] = (recommendationCounts[feedback.recommendation] || 0) + 1;
            facilityQualityCounts[feedback.facilityQuality] = (facilityQualityCounts[feedback.facilityQuality] || 0) + 1;
        });

        let avgRating = count ? (totalRatings / count).toFixed(2) : 0;
        let categoryHtml = Object.entries(categoryCounts).map(([category, count]) => `<p>${category}: ${count}</p>`).join('');
        let serviceSatisfactionHtml = Object.entries(serviceSatisfactionCounts).map(([satisfaction, count]) => `<p>${satisfaction}: ${count}</p>`).join('');
        let recommendationHtml = Object.entries(recommendationCounts).map(([recommendation, count]) => `<p>${recommendation}: ${count}</p>`).join('');
        let facilityQualityHtml = Object.entries(facilityQualityCounts).map(([quality, count]) => `<p>${quality}: ${count}</p>`).join('');

        feedbackAnalytics.innerHTML = `
            <h3>Average Rating: ${avgRating}</h3>
            <h3>Category Counts:</h3>
            ${categoryHtml}
            <h3>Service Satisfaction:</h3>
            ${serviceSatisfactionHtml}
            <h3>Recommendation:</h3>
            ${recommendationHtml}
            <h3>Facility Quality:</h3>
            ${facilityQualityHtml}
        `;
    } catch (error) {
        console.error("Error loading analytics: ", error);
    }
}

    // Deleting feedback
    document.getElementById("deleteFeedbackButton").addEventListener('click', async function (e) {
        e.preventDefault();
        const feedbackId = document.getElementById("feedbackSelect").value;
        const rehabName = document.getElementById("adminRehabName").value.trim();

        if (!feedbackId || !rehabName) {
            alert('Please select feedback to delete and enter a rehab name');
            return;
        }

        try {
            await deleteDoc(doc(db, `feedback_${rehabName}`, feedbackId));
            alert("Feedback deleted successfully!");
            loadFeedback();
        } catch (error) {
            console.error("Error deleting feedback: ", error);
        }
        
    });

</script>
</body>
</html>
 
